# 平衡二叉树
左右子树高度之差的绝对值不超过1的二叉排序树称为平衡二叉树。
## 插入
找到合适的位置插入，然后判断类型进行处理：

1. **LL：右旋**
2. **RR：左旋**
3. **LR：先左后右**
4. **RL：先右后左**
## 删除
删除一个节点后，会导致一棵子树失衡，假设删除w，则要回溯找到第一个不平衡节点z，y为z子树中高度最高的孩子节点，x是y中高度最高的孩子节点，根据x和y、z的位置进行处理，若x、y是z的：

1. **LL：右旋**
2. **RR：左旋**
3. **LR：先左后右**
4. **RL：先右后左**

**删除和插入操作类似，不同之处在于删除的调整，可能会导致另外的不平衡，需要反复多次进行调整。**
# 红黑树
## 概念
> 什么是红黑树，红黑树是一种特殊的二叉排序树，考试内容不会很深，简单清楚性质概念和插入操作即可，删除操作很难，考察概率不大。

**主要性质：**

1. 每个结点或黑或红
2. 根节点必黑
3. 叶节点必黑，这里的叶节点是外部结点
4. 不存在两个相邻的红节点
5. 任意一个节点，该节点到任意一个叶节点的简单路径上，经过的黑节点数目是一样的

**顺口溜：**
:::info

- 左根右（排序）
- 根叶黑
- 不红红
- 黑路同
:::
**两个结论：**

- **从根出发到叶节点的路径不大于最短路径的一半**
- **有n个内部红节点的红黑树高度**$h \le 2*log_{2}{(n+1)}$
- **插入的节点初始化为红**
## 插入操作

1. 第一步先确定要插入的位置
2. 若为根节点，直接染黑
3. 如果不破坏红黑树特征，正常
4. 如果破坏了“不红红”的条件，找到父亲的兄弟结点，也就是叔结点，按照叔结点的两种情况去调整:(1)红叔叔（2）黑叔叔

**（1）红叔叔**
叔、父、爷结点染色（颜色反转），同时爷结点变成新节点（变黑则无所谓，变红则要再调整）。
**（2）黑叔叔**
找父节点和爷结点，判断当前节点对于爷结点的位置进行调整：

1. LL：右旋，父节点换爷结点，同时父和爷染色
2. RR：左旋，父节点换爷结点，同时父和爷染色
3. LR：先左后右，当前节点先左后右，儿结点换爷结点，同时染色
4. RL：先右后左，当前节点先右后左，儿结点换爷结点，同时染色

# B树
## 概念
:::info

1. 树中每个结点至多有m个子树，即一个节点中至多m-1个关键字
2. 根节点至少两棵子树
3. 初根节点外的所有非叶节点，至少[m/2]（向上取整）棵子树，即至少有[m/2]（向上取整）-1个关键字
4. 所有叶节点在最后一层（NULL节点，空指针）
:::
![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698323978058-e3575c73-96ed-4899-bb74-8128a02adf74.png#averageHue=%23fafaf9&clientId=ud941de21-06d5-4&from=paste&height=484&id=u210ba789&originHeight=605&originWidth=1661&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=249011&status=done&style=none&taskId=u87fd74f9-be6b-42c6-8949-596862bab82&title=&width=1328.8)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698324074718-6393ead1-fb31-4527-92f6-1cd789d1e394.png#averageHue=%23dcc5b2&clientId=ud941de21-06d5-4&from=paste&height=286&id=u84067421&originHeight=357&originWidth=1605&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=248211&status=done&style=none&taskId=u279ec986-5b2d-4cbd-843d-afb71d16043&title=&width=1284)
## B树高（磁盘存取次数）
### 最矮
![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698324271389-11b820dc-3027-448a-abad-9a1cdb75b401.png#averageHue=%23f9f8f7&clientId=ud941de21-06d5-4&from=paste&height=821&id=uf1706ba1&originHeight=1026&originWidth=1429&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=540812&status=done&style=none&taskId=u8e118645-0539-4519-8e55-3ce74ff21d9&title=&width=1143.2)
### 最高
![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698324288134-e7314912-9c3b-482c-b7c8-a56d626afc42.png#averageHue=%23faf8f8&clientId=ud941de21-06d5-4&from=paste&height=910&id=u437e31d9&originHeight=1137&originWidth=1712&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=717922&status=done&style=none&taskId=u3d0023db-02a0-413e-9545-800a978de93&title=&width=1369.6)


## 查找

1. 在B树中找节点
2. 在节点中中找关键字

与节点中的关键字进行比对，其中节点的左指针指向的节点集合小于该节点，右指针指向的节点集合大于节点，依据这种特性，一层层进行查找，如果到最后NULL节点，则说明找不到了。

## 插入
**明确一点，一个节点内的关键字个数[（m/2）向上取整-1，m-1]**

1. 定位，找到应该插入的位置
2. 插入，如果关键字个数插入后在正确范围内，则直接插入，否则进行处理
3. 多的情况处理如下：

![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698324971343-770a4043-b621-453a-aee3-b4f2c9336446.png#averageHue=%23f0f0f0&clientId=ud941de21-06d5-4&from=paste&height=353&id=ue0fe0212&originHeight=441&originWidth=851&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=87006&status=done&style=none&taskId=u8ffebb37-d49e-413b-a09c-b8deb505520&title=&width=680.8)
如下处理：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698324984029-d7a6484f-8fd3-4da2-a32b-5674aeb85d8e.png#averageHue=%23f1f1f1&clientId=ud941de21-06d5-4&from=paste&height=362&id=ub8e00357&originHeight=452&originWidth=1258&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=110047&status=done&style=none&taskId=u7ef24cf4-c9f9-4954-a46a-c9b4aeceb72&title=&width=1006.4)

## 删除
**明确一点，一个节点内的关键字个数[（m/2）向上取整-1，m-1]，所以删除后节点的关键字个数不能小于（m/2）向上取整-1。**

1. 直接删除，如果删除满足关键字的最低要求，则直接删除
2.  如果在非终端节点，则用直接前驱或者直接后继来代替

![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698325630218-e81be467-3803-48b1-8b06-a51e2c88b995.png#averageHue=%23f4f3f2&clientId=ud941de21-06d5-4&from=paste&height=552&id=u185153a2&originHeight=690&originWidth=1333&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=170378&status=done&style=none&taskId=u04f79eb4-6066-4c27-9548-e571b91d2ae&title=&width=1066.4)

3. 如果在兄弟够借，即目前关键字删除前为**（m/2）向上取整-1**，且其左（右）兄弟的关键字数目大于**（m/2）向上取整，**则从兄弟中拿一个节点，放到父节点中，然后从父节点中拿一下下来填充给不满足要求的节点，称为父子换位法

![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698325791403-12bc95b6-125f-4ee3-8cdb-0c9ecec13c5c.png#averageHue=%23f2f2f2&clientId=ud941de21-06d5-4&from=paste&height=452&id=u680c592a&originHeight=565&originWidth=1354&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=116426&status=done&style=none&taskId=u43c0c641-a86a-4e19-88c9-3b3d755a72e&title=&width=1083.2)
这里的92处已经不满足，但是左兄弟仍然充裕，则进行父子换位法：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698325825332-f1f45d1a-5327-4e96-9c31-183c7d27f81d.png#averageHue=%23f1f1f0&clientId=ud941de21-06d5-4&from=paste&height=420&id=u299716c3&originHeight=525&originWidth=1353&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=114703&status=done&style=none&taskId=u85660c44-bdfa-4348-9656-441eda58449&title=&width=1082.4)

4. 兄弟不够借。当兄弟不够借的时候，当前节点+兄弟结点的个数为m-2，此时需要父节点落下一个节点，与兄弟合并，则合并后的节点关键字数目为m-1，同时父节点关键字数目-1。如果父节点不满足要求，则进行兄弟够借和兄弟不够借两种试探，进行填补跟合并。如果操作使得根节点-1变为0，则直接删除根节点，换成新的根节点。**(切记不可进行前驱后继填补)**

![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698327668029-fbe3f16e-55d3-48e3-9662-573d9b11d72f.png#averageHue=%23eeeeed&clientId=ud941de21-06d5-4&from=paste&height=526&id=ua9711fc0&originHeight=658&originWidth=1913&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=342812&status=done&style=none&taskId=ubaebf5d7-3bda-4e26-aabb-0b1f328c41b&title=&width=1530.4)
此时需要父节点落下70，进行合并：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698327720270-c8aae326-9bbf-487c-927d-33923ea3480c.png#averageHue=%23f1f1f1&clientId=ud941de21-06d5-4&from=paste&height=527&id=uf7619a26&originHeight=659&originWidth=1939&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=293147&status=done&style=none&taskId=u3f106dfc-6ac4-4e7c-90d1-cb329ab80b3&title=&width=1551.2)
73处不满足，同时左兄弟不够借，则82落下，进行合并：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698327752897-b10cab1a-d610-460e-b733-cfc995f70c02.png#averageHue=%23f1f1f1&clientId=ud941de21-06d5-4&from=paste&height=529&id=ub4a9fafa&originHeight=661&originWidth=1919&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=293674&status=done&style=none&taskId=u0f6a3950-079f-42c5-9c4b-3984cd28c39&title=&width=1535.2)
删除根节点，合并得新根节点：
![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698327779989-638def82-5ef4-49f4-8abd-b95a2fa9ad9b.png#averageHue=%23efefef&clientId=ud941de21-06d5-4&from=paste&height=306&id=u21b3e2eb&originHeight=383&originWidth=1927&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=172422&status=done&style=none&taskId=u4f3de5d2-60f0-42c9-bab2-6c4f6d23360&title=&width=1541.6)

# B+树（常用于关系型数据库的存储）
## 概念

1. m阶B+树每个结点最多m棵子树（也就是最多m个孩子节点）
2. 非叶、根节点至少有两棵子树，其他每个分支节点至少有（m/2）向上取整棵子树
3. 节点的子树个树和关键字个数一样
4. 叶节点包含所有关键字，也就是全部关键字都会存储在叶子节点，节点内按大小排序
5. 所有分支节点，中仅仅包含它所指向的子节点中的最大值，及其子节点的指针
6. 叶节点之间会有指针穿在一起（支持顺序查找）

![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698393486431-fbea76cf-eb56-454f-a853-fc660cd3850c.png#averageHue=%23f2f2f2&clientId=ua2017fc1-e685-4&from=paste&height=595&id=u5d528c69&originHeight=744&originWidth=1627&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=292463&status=done&style=none&taskId=u3c56fb8e-9880-4625-b012-890942084b0&title=&width=1301.6)
如上：3，9，15中存储的分别是三个子节点中的最大值，最后绿色的叶节点之间有指针连在一起。

## 查找
从根出发，找到合适的位置（处于哪个子节点），过程中会在非叶节点中遇到关键字，但这并不是查找成功，要一直查到叶节点中才算成功，这是区别于B树的一个地方，B树是能够在非终端节点中就找到结果的。
如下是一个查找成功的例子，查找9，从根出发，直到叶节点。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698393712632-04207ff4-7ebd-4c01-b2d1-c4bb061c70b8.png#averageHue=%23f5f4f3&clientId=ua2017fc1-e685-4&from=paste&height=662&id=ue640258f&originHeight=828&originWidth=1849&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=319788&status=done&style=none&taskId=u1cfafbfa-c759-420b-9f72-f844746f5e4&title=&width=1479.2)

如下是查找失败的例子：从根出发，进入15的子节点，然后进入9的子节点，对比了6->8，发现8已经大于7，则查找失败了。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698393759822-58af3bda-3a9a-445c-aadc-d57b8177144c.png#averageHue=%23f5f5f5&clientId=ua2017fc1-e685-4&from=paste&height=696&id=u4e7202fd&originHeight=870&originWidth=1816&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=345083&status=done&style=none&taskId=ua054e30f-0e5e-4687-922e-f56b9de16a3&title=&width=1452.8)
**总之无论成功与否，最终都一定要走到最下面的一层节点。**
## B和B+的类比
![image.png](https://cdn.nlark.com/yuque/0/2023/png/27603626/1698395348108-fd63a072-1c4f-4503-b7aa-bc6f7a4a9306.png#averageHue=%23cbcecc&clientId=ua2017fc1-e685-4&from=paste&height=762&id=u309c28eb&originHeight=953&originWidth=1911&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=669425&status=done&style=none&taskId=u37594b30-4d4d-42c9-ab04-41523ffeae2&title=&width=1528.8)

